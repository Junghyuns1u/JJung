# 🌙 수면 패턴 분석 프로젝트

소리 센서(스마트폰 마이크)로 수면 중 소리 변화를 기록하고, 파이썬으로 수면 패턴을 분석하는 프로젝트입니다.

## 📋 프로젝트 개요

### 주제
스마트폰 소리 센서로 밤새 소리 변화를 기록하고, 코딩으로 나의 수면 패턴을 분석한다.

### 가설

1. **가설 1**: 수면 중 dB 값이 높은 구간은 뒤척임·각성 가능성이 높다.
2. **가설 2**: 취침 전 스마트폰/게임 시간이 길수록 소음 구간 비율이 증가한다.

### 실험 조건

- **조건 A**: 평소 생활 패턴
- **조건 B**: 취침 전 2시간 폰 사용
- **조건 C**: 취침 전 폰 사용 최소화

## 🛠️ 준비물

- 스마트폰 1대
- 소리 로그 앱 (dBMeter, Sound Meter 등)
- 충전기
- 컴퓨터 (Python 3.7 이상)
- 필요한 Python 패키지 (아래 참조)

## 📦 설치 방법

### 1. Python 패키지 설치

```bash
pip install pandas numpy matplotlib seaborn scipy
```

또는 requirements.txt 사용:

```bash
pip install -r requirements.txt
```

### 2. 프로젝트 구조

```
sleep_analysis/
├── README.md                    # 이 파일
├── requirements.txt             # Python 패키지 목록
├── sleep_analyzer.py            # 메인 분석 스크립트
├── hypothesis_test.py           # 가설 검증 스크립트
├── data/                        # 데이터 폴더
│   ├── experiment_log.csv       # 실험 기록
│   ├── sample_sleep_data_A.csv  # 조건 A 데이터
│   ├── sample_sleep_data_B.csv  # 조건 B 데이터
│   └── sample_sleep_data_C.csv  # 조건 C 데이터
└── results/                     # 분석 결과 저장 폴더
    ├── sleep_analysis_A.png
    ├── condition_comparison.png
    └── hypothesis_test_report.txt
```

## 📊 데이터 수집 방법

### 1. 스마트폰 앱 설정

1. **dBMeter** 또는 **Sound Meter** 앱 설치
2. 측정 간격: **5초**로 설정
3. 로그 기록 기능 활성화

### 2. 측정 절차

#### 취침 전
1. 앱 실행 및 로그 시작
2. 폰을 머리맡 고정 위치에 배치
3. 충전기 연결
4. 취침

#### 기상 후
1. 기록 종료
2. CSV 파일로 내보내기
3. PC로 전송

### 3. CSV 파일 형식

데이터 파일은 다음 형식이어야 합니다:

```csv
시간,dB
23:30:00,35.2
23:30:05,36.1
23:30:10,34.8
...
```

### 4. 실험 기록 작성

`data/experiment_log.csv` 파일에 각 실험 정보를 기록합니다:

```csv
날짜,조건,취침시각,기상시각,폰사용시간(분),게임시간(분),카페인섭취,특이사항
2025-11-15,A,23:30,07:00,30,0,없음,평소 패턴
2025-11-16,B,23:45,07:15,120,60,커피1잔,취침 전 2시간 폰 사용
2025-11-17,C,23:00,06:45,10,0,없음,취침 전 폰 사용 최소화
```

## 🚀 사용 방법

### 방법 1: 웹 앱 (추천 ⭐)

가장 쉽고 직관적인 방법입니다!

```bash
cd sleep_analysis
streamlit run app.py
```

실행하면 브라우저가 자동으로 열리고 다음 기능을 사용할 수 있습니다:
- 📁 **데이터 업로드**: dBMeter 파일 드래그 앤 드롭
- 📊 **실시간 분석**: 클릭 한 번으로 분석 완료
- 📈 **인터랙티브 그래프**: 시간대별 수면 패턴 확인
- 🔬 **조건별 비교**: A/B/C 조건 한눈에 비교
- 💾 **보고서 생성**: 결과 다운로드

### 방법 2: 빠른 분석 스크립트

```bash
python quick_analysis.py
```

데이터를 빠르게 분석하고 그래프를 확인할 수 있습니다.

### 방법 3: 터미널 메뉴 방식

```bash
python menu_app.py
```

단계별로 선택하며 분석할 수 있습니다:
1. 데이터 업로드
2. 분석 실행
3. 그래프 보기
4. 보고서 생성

### 방법 4: 가설 검증 (고급)

```bash
python hypothesis_test.py
```

이 스크립트는:
- 모든 조건(A, B, C) 데이터 분석
- 조건별 비교 통계
- 가설 1, 2 검증
- 상관관계 분석 (피어슨 상관계수)
- 비교 그래프 생성
- 최종 보고서 생성

### 임계값 조정

설정 메뉴에서 임계값을 조정할 수 있습니다 (기본값: 35dB)

## 📈 분석 지표

### 주요 통계 지표

1. **소음 구간 비율 (%)**: 임계값 이상 구간의 비율
2. **평균 dB**: 전체 측정 구간 평균 음량
3. **최대 dB**: 최고 음량
4. **연속 소음 구간 평균 길이**: 연속된 소음 구간의 평균 시간
5. **수면 초반 1시간 소음 비율**: 입면 후 1시간 동안의 소음 비율

### 가설 검증 기준

- **가설 1**: 소음 구간(dB ≥ 임계값)의 비율 분석
- **가설 2**: 조건 B의 소음 비율이 조건 A보다 ≥5%p 높으면 지지

## 📊 예시 결과

### 통계 출력 예시

```
============================================================
수면 데이터 분석 결과
============================================================
총 측정 횟수                      :      720
총 측정 시간 분                    :    60.00
소음 구간 횟수                     :       45
소음 구간 비율 %                   :     6.25
평균 dB                           :    36.50
최대 dB                           :    52.30
연속 소음 구간 평균 길이 초         :    15.00
수면초반1시간 소음비율 %           :     8.33
============================================================
```

### 그래프

1. **시간-dB 그래프**: 수면 중 음량 변화 시각화
2. **조건별 비교 그래프**: 
   - 소음 구간 비율 비교
   - 평균 dB 비교
   - 폰 사용 시간 vs 소음 비율 산점도
   - 수면 초반 소음 비율 비교

## ⚠️ 실험 통제 요인

다음 요소들을 일정하게 유지해야 합니다:

- ✅ 폰 위치 (머리맡 동일 위치)
- ✅ 마이크 민감도 설정
- ✅ 알람 음량
- ✅ 선풍기/에어컨 상태
- ✅ 창문 개폐 상태
- ✅ 실내 온도

## 🔬 한계 및 개선 방안

### 한계점

1. **절대 dB 정확도 낮음**: 스마트폰 마이크는 전문 측정기가 아님
2. **주변 소음 영향**: 가족, 외부 소음 등이 녹음될 수 있음
3. **표본 크기**: 3일간 데이터로는 통계적 유의성이 제한적

### 개선 방안

- 폰 위치와 환경을 최대한 고정
- 측정 일수를 늘려 표본 크기 확대
- 주변 소음이 적은 환경에서 측정
- 가족 동의 및 데이터 비공개 저장 준수

## 📝 과학적 배경

### 수면과 소리의 관계

1. **수면 단계**: 얕은 수면(NREM 1-2) → 깊은 수면(NREM 3) → REM 수면
2. **각성 반응**: 갑작스러운 소음은 각성이나 수면 단계 전환을 유발
3. **뒤척임**: 근육 긴장이 일시적으로 증가하며 소음 발생 가능

### 스마트폰 사용과 수면의 관계

1. **블루라이트**: 멜라토닌 분비 억제
2. **각성 효과**: 게임, SNS 등은 뇌를 각성 상태로 유지
3. **수면 잠복기 증가**: 잠들기까지 시간이 길어짐

## 🤝 기여 및 문의

이 프로젝트는 학교 탐구 과제용으로 제작되었습니다.

---

## 🌐 온라인 배포 방법 (다른 사람들과 공유)

### Streamlit Community Cloud에 배포하기 (무료!)

다른 사람들이 인터넷으로 접속할 수 있는 링크를 만들 수 있습니다.

#### 1단계: GitHub에 코드 업로드

```bash
cd /workspaces/JJung
git add .
git commit -m "Add sleep analysis web app"
git push origin main
```

#### 2단계: Streamlit Community Cloud 배포

1. **[share.streamlit.io](https://share.streamlit.io)** 접속
2. **"New app"** 클릭
3. GitHub 계정 연결 (처음 한 번만)
4. 저장소 정보 입력:
   - Repository: `Junghyuns1u/JJung`
   - Branch: `main`
   - Main file path: `sleep_analysis/app.py`
5. **"Deploy!"** 클릭

#### 3단계: 공유

배포가 완료되면 (약 2-3분 소요):
- 예시 링크: `https://your-app-name.streamlit.app`
- 이 링크를 친구들에게 공유하면 누구나 브라우저에서 바로 사용 가능! 🎉

### 배포 시 필요한 파일

프로젝트에 이미 포함되어 있습니다:
- ✅ `requirements.txt` - 필요한 Python 패키지 목록
- ✅ `app.py` - 메인 웹 애플리케이션
- ✅ 모든 분석 스크립트

### 주의사항

- ⚠️ 무료 플랜은 월 사용량 제한 있음
- ⚠️ 개인정보가 포함된 데이터는 업로드하지 마세요
- ✅ 앱이 꺼져있어도 링크는 유효하며, 접속 시 자동 재시작

### 로컬 네트워크 공유 (같은 Wi-Fi)

같은 Wi-Fi를 사용하는 친구들과 공유:

```bash
streamlit run app.py --server.address=0.0.0.0
```

터미널에 표시되는 `Network URL`을 공유하면 됩니다.

---

## 📄 라이선스

이 프로젝트는 교육 목적으로 자유롭게 사용할 수 있습니다.

---

**참고**: 이 프로젝트는 의학적 진단 도구가 아닙니다. 수면 문제가 있다면 전문의와 상담하세요.
